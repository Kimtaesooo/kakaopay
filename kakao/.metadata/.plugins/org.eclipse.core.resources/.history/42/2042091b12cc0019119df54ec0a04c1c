<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="com.kakaopay.dao.AnctDataInfoDao">
 
 	<!--
 		namespace에는 데이터를 컨트롤할 객체의 패키지명 전문을 선언 즉, dao를 뜻함
 		 
        mybatis-config.xml의 typeAlias에 등록해두지 않았다면 
        
        <select id="selectRankYearSumAmt" resultType="com.kakaopay.model.AcntDataInfoModel" >
            select 거래일자, 계좌번호 from 데이터_거래내역
        </select>
        
                  이렇게 해야 한다.
    -->
    <!-- 
    	id는 나중에 DAO에서 사용하기 위해 필요한 값이고, resultType은 쿼리 실행 후 데이터를  acntDataInfoModel에 담겠다고 설정
     -->
    <select id="selectRankYearSumAmt" parameterType="String" resultType="com.kakaopay.model.AcntDataInfoModel">
		select 거래일자
		     , 계좌명
			 , 계좌번호
			 , max(합계) as 합계
		from
		(
		     select year(a.거래일자)      as 거래일자
		          , b.계좌명             as 계좌명
		          , a.계좌번호            as 계좌번호
		          , sum(a.금액 - a.수수료) as 합계
		       from 데이터_거래내역 a
		          , 데이터_계좌정보 b
		      where 1=1
		        and a.계좌번호 = b.계좌번호
		        and a.취소여부 = 'N'
		        and year(a.거래일자) in ( #{year} )
		   group by year(a.거래일자), a.계좌번호
		   order by year(a.거래일자) desc, sum(a.금액-a.수수료) desc
		) A
		group by 거래일자
    </select>
    
</mapper>