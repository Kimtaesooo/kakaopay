package com.kakaopay.service;

import java.util.ArrayList;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.configurationprocessor.json.JSONArray;
import org.springframework.boot.configurationprocessor.json.JSONObject;
import org.springframework.stereotype.Service;

import com.kakaopay.dao.AnctDataInfoDao;
import com.kakaopay.model.NoDealCustomerModel;
import com.kakaopay.model.RankYearBrAmtModel;
import com.kakaopay.model.RankYearSumAmtModel;

@Service
public class AnctDataInfoServiceImpl implements AnctDataInfoService {
	
	@Autowired
    private AnctDataInfoDao anctDataInfoDao;

	@Override
	public List<RankYearSumAmtModel> selectRankYearSumAmt(String year) throws Exception {
		
		// 연도별 max 합계 금액 조회
		return anctDataInfoDao.selectRankYearSumAmt(year);
	}

	@Override
	public List<NoDealCustomerModel> selectNoDealCustomer(String year) throws Exception {
		
		// 거래가 없는 고객 조회
		return anctDataInfoDao.selectNoDealCustomer(year);
	}

	@Override
	public String selectRankYearBrAmt(List<String> year) throws Exception {
		String[] resultYear = new String[year.size()];
		
		List <JSONObject> list = new ArrayList <JSONObject>();
		JSONArray jArray = new JSONArray(); //배열이 필요할때
		
		for(int i=0; i < year.size(); i++) {
			resultYear[i] = year.get(i);
			List<RankYearBrAmtModel> resultRankYearBrAmtModel = new ArrayList <RankYearBrAmtModel>();
			resultRankYearBrAmtModel = anctDataInfoDao.selectRankYearBrAmt(resultYear[i]);
			
			JSONObject obj = new JSONObject();
			
			for(int k=0; k < resultRankYearBrAmtModel.size(); k++) {
				JSONObject sObject = new JSONObject(); //배열 내에 들어갈 json
				sObject.put("brName", resultRankYearBrAmtModel.get(k).get관리점명());
				sObject.put("brCode", resultRankYearBrAmtModel.get(k).get관리점코드());
				sObject.put("sumAmt", resultRankYearBrAmtModel.get(k).get합계());
				
				jArray.put(sObject);
			}
			
			obj.put("year", year.get(i));
			obj.put("dataList", jArray);
			
			list.add(obj);
			
			resultRankYearBrAmtModel.clear();
		}
		
		
		
		// 연도별 관리점별 거래금액 합계 조회 후 큰 순서로 출력
//		JSONObject obj = new JSONObject();
//		JSONArray jArray = new JSONArray(); //배열이 필요할때
//		
//		for(int i=0; i < resultRankYearBrAmtModel.size(); i++) {
//			JSONObject sObject = new JSONObject(); //배열 내에 들어갈 json
//			sObject.put("brName", resultRankYearBrAmtModel.get(i).get관리점명());
//			sObject.put("brCode", resultRankYearBrAmtModel.get(i).get관리점코드());
//			sObject.put("sumAmt", resultRankYearBrAmtModel.get(i).get합계());
//			jArray.put(sObject);
//		}
//		
//		obj.put("year", year.get(0));
//		obj.put("dataList", jArray);
		
		String result = list.toString();
		
		return result;
	}

} 
